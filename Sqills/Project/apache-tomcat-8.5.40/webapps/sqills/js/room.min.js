$(function(){var e,a,t,i,n,s,r,o,l,d,m,c,v;null==localStorage.getItem("defaultRoom")&&localStorage.setItem("defaultRoom",JSON.stringify({id:$("html").data("id"),name:$("html").data("name")})),e=$("#clock"),a=$("html").data("id"),t="/sqills/api/rooms/"+a+"/reservations",i=$("#statusContainer"),n=$("#status"),s=$("#time"),r=$("#additionalInformation"),function a(){e.html((new Date).toString().substring(16,21)),$.getJSON(t,function(e){var a,t,o,l,d,m,c;t=function(e=(new Date).getTime(),a=(new Date).getTime()){return new Date(e).toString().substring(16,21)+" - "+new Date(a).toString().substring(16,21)},o=function(e){var a,t,i;return e.visible?(a=e.user.firstName+" "+e.user.lastName,t=e.numberOfAttendees-1,i=e.name+"<br>"+a,t>0&&(i+=" and "+t+(1===t?" other":" others")),i):"Private"},a={a:"status-success",b:"Available",c:"",d:""},e.length>0&&(l=e[0],d=(new Date).getTime(),m=l.startTime,c=l.endTime,d<m?m-d<=3e5&&(a.a="status-warning",a.b="Occupied Soon",a.c=t(m,c),a.d=o(l)):c-d>3e5?(a.a="status-danger",a.b="Occupied",a.c=t(m,c),a.d=o(l)):(a.a="status-warning",a.b="Available Soon",a.c=t(m,c),a.d=o(l))),i.prop("class",a.a),n.html(a.b),s.html(a.c),r.html(a.d)}).fail(function(){clearTimeout(o),console.log("Failed to get data from server. Please refresh page when server is online.")}),o=setTimeout(a,1e3)}(),$(".open").click(function(){var e,a,t,i;e=$("#arrow"),$(".footerDrawer .content").slideToggle(),"none"===e.css("transform")?e.css("transform","rotate(180deg)"):e.css("transform",""),a=$("#makeReservationButton"),t=$("#other"),i=$("#status-box"),"none"===a.css("display")?(a.css("display","block"),t.css("display","block"),i.fadeIn()):(a.css("display","none"),t.css("display","none"),i.fadeOut())}),l=/^[a-zA-Z0-9.!#$%&â€™*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,d=function(e){l.test($(e).val())?$(e).removeClass("invalid"):$(e).addClass("invalid")},$("#email").change(function(){d("#email")}),m=0,$("#addAdditionalAttendee").click(function(){var e,a;a='<div class="col"><div class="md-form"><input type="email" id='+(e="additionalAttendee"+m+"Email")+' class="form-control white-text invalid"><label for='+e+">Additional attendee email</label></div></div>",m%2==0?$("#name").parents(".form-row").before('<div class="form-row">'+a+"</div>"):$("#additionalAttendee"+(m-1)+"Email").parents(".col").after(a),$("#"+e).change(function(){d("#"+e)}),m++}),$("#removeAdditionalAttendee").click(function(){var e;0!==m&&(e="#additionalAttendee"+(m-1)+"Email",m%2==0?$(e).parents(".col").remove():$(e).parents(".form-row").remove(),m--)}),$("#date").pickadate({clear:"",format:"mmm dd yyyy",min:new Date}),$("#startTime").change(function(){var e,a;e=$(this).val(),a=$("#endTime").val(),""===e?$(this).addClass("invalid"):""!==a?e>=a?($(this).addClass("invalid"),$("#endTime").addClass("invalid")):($(this).removeClass("invalid"),$("#endTime").removeClass("invalid")):$(this).removeClass("invalid")}),$("#startTime").pickatime({afterDone:function(){$("#startTime").trigger("change")}}),$("#endTime").change(function(){var e,a;e=$(this).val(),a=$("#startTime").val(),""===e?$(this).addClass("invalid"):""!==a?e<=a?($(this).addClass("invalid"),$("#startTime").addClass("invalid")):($(this).removeClass("invalid"),$("#startTime").removeClass("invalid")):$(this).removeClass("invalid")}),$("#endTime").pickatime({afterDone:function(){$("#endTime").trigger("change")}}),$("#makeReservation").click(function(){var e,a,t,i;if(!($("#darkModalForm").find(".invalid").length>0)){for(e=$("#date").val(),a=[],t=0;t<m;t++)a.push({email:$("#additionalAttendee"+t+"Email").val()});i={room:{id:parseInt($("#room").val())},startTime:new Date(e+" "+$("#startTime").val()).getTime(),endTime:new Date(e+" "+$("#endTime").val()).getTime(),creator:{email:$("#email").val()},name:$("#name").val(),additionalAttendees:a,visible:$("#visible").prop("checked")},$("#makeReservation").html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.post({url:"/sqills/api/reservations",data:JSON.stringify(i),success:function(e){$("#makeReservation").html('<strong class="black-text">Make reservation</strong>'),"success"!==e.status?"overlap"===e.reason?($("#startTime").addClass("invalid"),$("#endTime").addClass("invalid")):"user not found"===e.reason&&$("#email").addClass("invalid"):$("#darkModalForm").modal("hide")},contentType:"application/json"})}}),$("#makeReservationButton").click(function(){$(this).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.getJSON("/sqills/api/rooms",function(e){var a,t,i,n,s;for(t=(a=$("#room")).prop("options"),i=0;i<e.length;i++)n=e[i],t.add(new Option(n.name,n.id));$("#room").materialSelect(),s=$("html").data("name"),$(t).each(function(e,t){if(s===$(t).text())return a.siblings("ul").children("li:eq("+e+")").trigger("click"),!1}),a.siblings("input").addClass("white-text"),$("#date").pickadate("picker").set("min",new Date),$("#date").val((new Date).toString().substring(4,15)).trigger("change"),$("#startTime").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)).toString().substring(16,21)).trigger("change"),$("#endTime").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)+18e5).toString().substring(16,21)).trigger("change"),$("#makeReservationButton").html("Make reservation"),$("#darkModalForm").modal("show")})}),$("#darkModalForm").on("hidden.bs.modal",function(){for($("#darkModalForm").find(".invalid").removeClass("invalid"),$("#email").val("").trigger("change");m>0;)$("#removeAdditionalAttendee").trigger("click");$("#name").val("").trigger("change"),$("#visible").prop("checked",!0),$("#room").parents(".md-form").html('<select class="mdb-select colorful-select dropdown-warning" searchable="Search room.." id="room"><option value="" disabled selected>Choose room</option></select>')}),c=!1,$(".open").click(function(){c?(v.destroy(),c=!1):($(".content").height(function(){return Math.min(.75*$(document).height(),578)}),$.getJSON("/sqills/api/reservations",function(e){var a=[],t=$("html").data("id");$(e).each(function(e,i){t===i.room.id&&a.push({title:i.name,start:i.startTime,end:i.endTime})}),(v=new FullCalendar.Calendar($("#calendar").get(0),{schedulerLicenseKey:"GPL-My-Project-Is-Open-Source",contentHeight:520,plugins:["dayGrid","timeGrid"],defaultView:"timeGridDay",header:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay"},allDaySlot:!1,minTime:"08:00:00",maxTime:"17:00:00",events:a})).render(),c=!0}))})});