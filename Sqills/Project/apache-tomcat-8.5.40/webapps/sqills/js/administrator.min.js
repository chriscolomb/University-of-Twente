$(function(){var e,a,t;$.get({url:"/sqills/administrator/reservations",success:function(e){var a;a=[],$.each(e,function(e,t){t.startTime=new Date(t.startTime).toString().substring(4,21),t.endTime=new Date(t.endTime).toString().substring(4,21),a.push(t)}),$("#dt-select").DataTable({columns:[{data:"room.name",title:"Room"},{data:"startTime",title:"Start time",type:"date"},{data:"endTime",title:"End time",type:"date"},{data:"user.email",title:"User"},{data:"name",orderable:!1,title:"Name"},{data:"numberOfAttendees",orderable:!1,title:"Number of attendees"},{data:"visible",title:"Visible"}],data:a,dom:"ftipr",order:[[1,"asc"]],select:{blurable:!1,info:!1,style:"single"}}).on("deselect",function(){$("#editButton").prop("disabled",!0),$("#deleteButton").prop("disabled",!0)}).on("select",function(){$("#editButton").prop("disabled",!1),$("#deleteButton").prop("disabled",!1)})},error:function(){alert("Another device logged in."),location.reload()}}),$("#logout").click(function(){$.ajax("/sqills/administrator",{method:"DELETE",success:function(){$(location).prop("href","/sqills")}})}),e=/^[a-zA-Z0-9.!#$%&â€™*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,a=function(a){e.test($(a).val())?$(a).removeClass("invalid"):$(a).addClass("invalid")},$("#email").change(function(){a("#email")}),t=0,$("#addAdditionalAttendee").click(function(){var e,i;i='<div class="col"><div class="md-form"><input type="email" id='+(e="additionalAttendee"+t+"Email")+' class="form-control invalid"><label for='+e+">Additional attendee email</label></div></div>",t%2==0?$("#name").parents(".form-row").before('<div class="form-row">'+i+"</div>"):$("#additionalAttendee"+(t-1)+"Email").parents(".col").after(i),$("#"+e).change(function(){a("#"+e)}),t++}),$("#removeAdditionalAttendee").click(function(){var e;0!==t&&(e="#additionalAttendee"+(t-1)+"Email",t%2==0?$(e).parents(".col").remove():$(e).parents(".form-row").remove(),t--)}),$("#date").pickadate({clear:"",format:"mmm dd yyyy",min:new Date}),$("#startTime").change(function(){var e,a;e=$(this).val(),a=$("#endTime").val(),""===e?$(this).addClass("invalid"):""!==a?e>=a?($(this).addClass("invalid"),$("#endTime").addClass("invalid")):($(this).removeClass("invalid"),$("#endTime").removeClass("invalid")):$(this).removeClass("invalid")}),$("#startTime").pickatime({afterDone:function(){$("#startTime").change()}}),$("#endTime").change(function(){var e,a;e=$(this).val(),a=$("#startTime").val(),""===e?$(this).addClass("invalid"):""!==a?e<=a?($(this).addClass("invalid"),$("#startTime").addClass("invalid")):($(this).removeClass("invalid"),$("#startTime").removeClass("invalid")):$(this).removeClass("invalid")}),$("#endTime").pickatime({afterDone:function(){$("#endTime").change()}}),$("#addReservationButton").click(function(){var e,a,i,n;if($("#modalRegisterForm").find("input").change(),!($("#modalRegisterForm").find(".invalid").length>0||null===$("#room").val())){for(e=$("#date").val(),a=[],i=0;i<t;i++)a.push({email:$("#additionalAttendee"+i+"Email").val()});n={room:{id:parseInt($("#room").val())},startTime:new Date(e+" "+$("#startTime").val()).getTime(),endTime:new Date(e+" "+$("#endTime").val()).getTime(),creator:{email:$("#email").val()},name:$("#name").val(),additionalAttendees:a,visible:$("#visible").prop("checked")},$("#addReservationButton").html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.post({url:"/sqills/administrator/reservations",data:JSON.stringify(n),success:function(e){var a;$("#addReservationButton").html('<strong class="black-text">Add reservation</strong>'),"success"===e.status?($("#modalRegisterForm").modal("hide"),(a=e.reservation).startTime=new Date(a.startTime).toString().substring(4,21),a.endTime=new Date(a.endTime).toString().substring(4,21),$("#dt-select").DataTable().row.add(a).draw()):"overlap"===e.reason?($("#startTime").addClass("invalid"),$("#endTime").addClass("invalid")):"user not found"===e.reason&&$("#email").addClass("invalid")},error:function(){alert("Another device logged in"),location.reload()},contentType:"application/json"})}}),$("#modalRegisterForm").on("hidden.bs.modal",function(){for($("#modalRegisterForm").find(".invalid").removeClass("invalid"),$("#email").val("").change();t>0;)$("#removeAdditionalAttendee").click();$("#name").val("").change(),$("#visible").prop("checked",!0),$("#room").parents(".md-form").html('<select class="mdb-select colorful-select dropdown-warning" searchable="Search room.." id="room"><option value="" disabled selected>Choose room</option></select>')}),$("#addButton").click(function(){$(this).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.getJSON("/sqills/api/rooms",function(e){var a,t,i;for(a=$("#room").prop("options"),t=0;t<e.length;t++)i=e[t],a.add(new Option(i.name,i.id));$("#room").materialSelect(),$("#date").pickadate("picker").set("min",new Date),$("#date").val((new Date).toString().substring(4,15)).change(),$("#startTime").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)).toString().substring(16,21)).change(),$("#endTime").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)+18e5).toString().substring(16,21)).change(),$("#addButton").html('Add<i class="fas fa-plus-square ml-1"></i>'),$("#modalRegisterForm").modal("show")})}),$("#date2").pickadate({clear:"",format:"mmm dd yyyy",min:new Date}),$("#date2").val((new Date).toString().substring(4,15)).change(),$("#startTime2").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)).toString().substring(16,21)).change().change(function(){var e,a;e=$(this).val(),a=$("#endTime2").val(),""===e?$(this).addClass("invalid"):""!==a?e>=a?($(this).addClass("invalid"),$("#endTime2").addClass("invalid")):($(this).removeClass("invalid"),$("#endTime2").removeClass("invalid")):$(this).removeClass("invalid")}),$("#startTime2").pickatime({afterDone:function(){$("#startTime2").change()}}),$("#endTime2").val(new Date(18e5*Math.ceil((new Date).getTime()/18e5)+18e5).toString().substring(16,21)).change().change(function(){var e,a;e=$(this).val(),a=$("#startTime2").val(),""===e?$(this).addClass("invalid"):""!==a?e<=a?($(this).addClass("invalid"),$("#startTime2").addClass("invalid")):($(this).removeClass("invalid"),$("#startTime2").removeClass("invalid")):$(this).removeClass("invalid")}),$("#endTime2").pickatime({afterDone:function(){$("#endTime2").change()}}),$("#editReservation").click(function(){var e,a;$("#modalEditReservation").find("input:not([readonly])").change(),$("#modalEditReservation").find(".invalid").length>0||(e=$("#date2").val(),a={eventId:$("#dt-select").DataTable().row().data().eventId,room:{id:parseInt($("#room2").val())},startTime:new Date(e+" "+$("#startTime2").val()).getTime(),endTime:new Date(e+" "+$("#endTime2").val()).getTime(),name:$("#name2").val(),visible:$("#visible2").prop("checked")},$("#editReservation").html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.ajax("/sqills/administrator/reservations",{contentType:"application/json",data:JSON.stringify(a),method:"PUT",success:function(e){var a,t;$("#editReservation").html('<strong class="black-text">Edit reservation</strong>'),"success"===e.status?((a=e.reservation).startTime=new Date(a.startTime).toString().substring(4,21),a.endTime=new Date(a.endTime).toString().substring(4,21),(t=$("#dt-select").DataTable().row(".selected")).data(a).draw(),t.deselect(),$("#modalEditReservation").modal("hide")):"overlap"===e.reason?($("#startTime2").addClass("invalid"),$("#endTime2").addClass("invalid")):"user not found"===e.reason&&$("#email2").addClass("invalid")},error:function(){alert("Another device logged in."),location.reload()}}))}),$("#modalEditReservation").on("hidden.bs.modal",function(){$("#modalEditReservation").find(".invalid").removeClass("invalid"),$("#email2").val("").change(),$("#name2").val("").change(),$("#visible2").prop("checked",!0),$("#room2").parents(".md-form").html('<select class="mdb-select colorful-select dropdown-warning" searchable="Search room.." id="room2"><option value="" disabled selected>Choose room</option></select>')}),$("#editButton").click(function(){$(this).html('<span class="spinner-border spinner-border-sm mr-2" role="status" aria-hidden="true"></span>'),$.getJSON("/sqills/api/rooms",function(e){var a,t,i,n,s;for(t=(a=$("#room2")).prop("options"),i=0;i<e.length;i++)n=e[i],t.add(new Option(n.name,n.id));$("#room2").materialSelect(),s=$("#dt-select").DataTable().row(".selected").data(),$(t).each(function(e,t){if(s.room.id===parseInt($(t).val()))return a.siblings("ul").children("li:eq("+e+")").click(),!1}),$("#email2").val(s.user.email).change(),$("#name2").val(s.name).change(),$("#visible2").prop("checked",s.visible).change(),$("#date2").val(new Date(s.startTime).toString().substring(4,15)).change(),$("#startTime2").val(new Date(s.startTime).toString().substring(16,21)).change(),$("#endTime2").val(new Date(s.endTime).toString().substring(16,21)).change(),$("#editButton").html('Edit<i class="fas fa-pencil-square-o ml-1"></i>'),$("#modalEditReservation").modal("show")})}),$("#btnYes").click(function(){var e;e=$("#dt-select").DataTable().row(".selected"),$.ajax("/sqills/administrator/reservations?eventId="+e.data().eventId,{method:"DELETE",success:function(){e.deselect(),e.remove().draw()},error:function(){alert("Another device logged in."),location.reload()}})}),$("#deleteButton").click(function(){$("#modalDelete").modal("show")})});